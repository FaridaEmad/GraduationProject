<!-- Business Management Container -->
<div class="business-management-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-wrapper">
        <i class="bi bi-building-fill title-icon"></i>
        <div class="title-text">
          <h1 class="page-title">Business Management</h1>
          <p class="page-subtitle">Manage and monitor business listings</p>
        </div>
      </div>
    </div>
    <button class="btn btn-primary add-business-btn" (click)="openAddModal()">
      <i class="bi bi-plus-lg me-2"></i>Add Business
    </button>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="row g-3">
      <div class="col-12 col-md-3">
        <div class="search-box">
          <i class="bi bi-search search-icon"></i>
          <input type="text" class="form-control search-input" 
                 placeholder="Search businesses..." 
                 [(ngModel)]="searchText" 
                 (input)="onSearchChange()">
        </div>
      </div>
      <div class="col-12 col-md-3">
        <select class="form-select" [(ngModel)]="selectedCategoryId" 
                (change)="onCategoryChange()" 
                [ngModelOptions]="{standalone: true}">
          <option [ngValue]="null">All Categories</option>
          <option *ngFor="let category of categories" [ngValue]="category.categoryId">
            {{ category.name }}
          </option>
        </select>
      </div>
      <div class="col-12 col-md-3">
        <select class="form-select" [(ngModel)]="selectedCity" (change)="applyFilters()">
          <option value="">All Cities</option>
          <option *ngFor="let city of cities">{{ city }}</option>
        </select>
      </div>
      <div class="col-12 col-md-3">
        <select class="form-select" [(ngModel)]="selectedArea" (change)="applyFilters()">
          <option value="">All Areas</option>
          <option *ngFor="let area of areas">{{ area }}</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Business Table -->
  <div *ngIf="paginatedBusinesses.length > 0; else noData" class="table-card">
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Business</th>
            <th>Location</th>
            <th>Category</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let business of paginatedBusinesses; let i = index; trackBy: trackById">
            <td>
              <div class="business-info">
                <div class="business-logo">
                  <img [src]="business.logo" [alt]="business.name" class="rounded-circle">
                </div>
                <div class="business-name">{{ business.name }}</div>
              </div>
            </td>
            <td>
              <div class="location-info">
                <span class="city">{{ business.city }}, </span>
                <span class="area">{{ business.area }}</span>
              </div>
            </td>
            <td>
              <span class="category-badge">
                {{ getCategoryName(business.categoryId) }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button class="btn btn-sm btn-outline-primary me-2" (click)="openEditModal(business)">
                  <i class="bi bi-pencil-square"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger" (click)="confirmDelete(business.id)">
                  <i class="bi bi-trash-fill"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- No Data Template -->
  <ng-template #noData>
    <div class="no-data-card">
      <i class="bi bi-exclamation-circle"></i>
      <p>{{ noDataMessage || 'No businesses found' }}</p>
    </div>
  </ng-template>

  <!-- Pagination -->
  <div class="pagination-section">
    <nav aria-label="Page navigation">
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <a class="page-link" (click)="changePage(currentPage - 1)" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
          </a>
        </li>
        <li class="page-item" *ngFor="let page of totalPages" [class.active]="page === currentPage">
          <a class="page-link" (click)="changePage(page)">{{ page }}</a>
        </li>
        <li class="page-item" [class.disabled]="currentPage === totalPages.length">
          <a class="page-link" (click)="changePage(currentPage + 1)" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
          </a>
        </li>
      </ul>
    </nav>
  </div>

  <!-- Business Modal -->
  <dialog #businessModal class="modal-dialog rounded-2">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ isEditMode ? 'Edit Business' : 'Add Business' }}</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="form" (ngSubmit)="onSubmit()" class="business-form">
          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">Business Name</label>
                <input class="form-control" formControlName="name" placeholder="Enter business name"
                       [class.is-invalid]="name?.invalid && name?.touched">
                <div class="invalid-feedback" *ngIf="name?.errors?.['required'] && name?.touched">
                  Business name is required
                </div>
                <div class="invalid-feedback" *ngIf="name?.errors?.['minlength'] && name?.touched">
                  Business name must be at least 3 characters
                </div>
                <div class="invalid-feedback" *ngIf="name?.errors?.['maxlength'] && name?.touched">
                  Business name cannot exceed 100 characters
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">Category</label>
                <select class="form-select" formControlName="categoryId" placeholder="Select category"
                        [class.is-invalid]="categoryId?.invalid && categoryId?.touched">
                  <option [ngValue]="null">Select Category</option>
                  <option *ngFor="let category of categories" [ngValue]="category.categoryId">
                    {{ category.name }}
                  </option>
                </select>
                <div class="invalid-feedback" *ngIf="categoryId?.errors?.['required'] && categoryId?.touched">
                  Please select a category
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">City</label>
                <input class="form-control" formControlName="city" placeholder="Enter city"
                       [class.is-invalid]="city?.invalid && city?.touched">
                <div class="invalid-feedback" *ngIf="city?.errors?.['required'] && city?.touched">
                  City is required
                </div>
                <div class="invalid-feedback" *ngIf="city?.errors?.['minlength'] && city?.touched">
                  City must be at least 2 characters
                </div>
                <div class="invalid-feedback" *ngIf="city?.errors?.['maxlength'] && city?.touched">
                  City cannot exceed 50 characters
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">Area</label>
                <input class="form-control" formControlName="area" placeholder="Enter area"
                       [class.is-invalid]="area?.invalid && area?.touched">
                <div class="invalid-feedback" *ngIf="area?.errors?.['required'] && area?.touched">
                  Area is required
                </div>
                <div class="invalid-feedback" *ngIf="area?.errors?.['minlength'] && area?.touched">
                  Area must be at least 2 characters
                </div>
                <div class="invalid-feedback" *ngIf="area?.errors?.['maxlength'] && area?.touched">
                  Area cannot exceed 50 characters
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">Logo URL</label>
                <input class="form-control" formControlName="logo" placeholder="Enter logo URL"
                       [class.is-invalid]="logo?.invalid && logo?.touched">
                <div class="invalid-feedback" *ngIf="logo?.errors?.['required'] && logo?.touched">
                  Logo URL is required
                </div>
                <div class="invalid-feedback" *ngIf="logo?.errors?.['pattern'] && logo?.touched">
                  Please enter a valid image URL (must start with http:// or https:// and end with .jpg, .jpeg, .png, .gif, .webp, or .svg)
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label class="form-label">Admin</label>
                <select class="form-select" formControlName="userId"
                        [class.is-invalid]="userId?.invalid && userId?.touched">
                  <option [ngValue]="null">Select Admin</option>
                  <option *ngFor="let admin of adminUsers" [value]="admin.userId">
                    {{ admin.name }} ({{ admin.email }})
                  </option>
                </select>
                <div class="invalid-feedback" *ngIf="userId?.errors?.['required'] && userId?.touched">
                  Please select an admin
                </div>
              </div>
            </div>
            <div class="col-12">
              <div class="form-group">
                <label class="form-label">Image URLs</label>
                <textarea class="form-control" formControlName="imageUrls" rows="2" 
                          placeholder="Enter image URLs separated by commas (e.g., https://example.com/image1.jpg, https://example.com/image2.png)"
                          [class.is-invalid]="imageUrls?.invalid && imageUrls?.touched"></textarea>
                <div class="invalid-feedback" *ngIf="imageUrls?.errors?.['pattern'] && imageUrls?.touched">
                  Please enter valid image URLs separated by commas. Each URL must:
                  <ul class="mb-0 mt-1">
                    <li>Start with http:// or https://</li>
                    <li>End with .jpg, .jpeg, .png, .gif, .webp, or .svg</li>
                    <li>Be separated by commas</li>
                  </ul>
                  Example: https://example.com/image1.jpg, https://example.com/image2.png
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-light" (click)="closeModal()">Cancel</button>
            <button type="submit" class="btn btn-primary" [disabled]="form.invalid">
              {{ isEditMode ? 'Update Business' : 'Add Business' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </dialog>
</div>