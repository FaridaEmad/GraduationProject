<!-- User Management Header -->
<div class="user-management-container">
    <div class="page-header">
        <div class="header-content">
            <div class="title-wrapper">
                <i class="bi bi-people-fill title-icon"></i>
                <div class="title-text">
                    <h1 class="page-title">User Management</h1>
                    <p class="page-subtitle">Manage and monitor user accounts</p>
                </div>
            </div>
        </div>
        <button class="btn btn-primary add-admin-btn" (click)="openAddAdminModal()">
            <i class="bi bi-person-plus-fill me-2"></i>Add Admin
        </button>
    </div>

    <!-- Filters Section -->
    <div class="filters-section">
        <div class="row g-3">
            <div class="col-12 col-md-3">
                <div class="search-box">
                    <i class="bi bi-search search-icon"></i>
                    <input type="text" [(ngModel)]="searchTerm" (input)="filterUsers()" 
                           class="form-control search-input" placeholder="Search users...">
                </div>
            </div>
            <div class="col-12 col-md-3">
                <select class="form-select" [(ngModel)]="genderFilter" (change)="filterUsers()">
                    <option value="">All Genders</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                </select>
            </div>
            <div class="col-12 col-md-3">
                <select class="form-select" [(ngModel)]="sortBy" (change)="sortUsers()">
                    <option value="name">Sort by Name</option>
                    <option value="createdAt">Sort by Date</option>
                </select>
            </div>
            <div class="col-12 col-md-3">
                <select class="form-select" [(ngModel)]="sortDirection" (change)="sortUsers()">
                    <option value="asc">Ascending</option>
                    <option value="desc">Descending</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Users Table -->
    <div class="table-card">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Profile</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Gender</th>
                        <th>Created At</th>
                        <th>Role</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let user of filteredUsers">
                        <td>
                            <div class="user-avatar">
                                <img [src]="user.profilePhoto" [alt]="user.name" class="rounded-circle">
                            </div>
                        </td>
                        <td>{{ user.name }}</td>
                        <td>{{ user.email }}</td>
                        <td>
                            <span class="badge" [ngClass]="user.gender === 'male' ? 'bg-primary' : 'bg-pink'">
                                {{ user.gender }}
                            </span>
                        </td>
                        <td>{{ user.createdAt | date:'medium' }}</td>
                        <td>
                            <span class="badge" [ngClass]="user.isAdmin ? 'bg-success' : 'bg-info'">
                                {{ user.isAdmin ? 'Admin' : 'User' }}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-outline-primary me-2" (click)="editUser(user)">
                                    <i class="bi bi-pencil-square"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" (click)="deleteUser(user.userId)">
                                    <i class="bi bi-trash-fill"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>


    <!-- Pagination -->
    <div class="pagination-wrapper" *ngIf="totalPages > 1">
        <div class="pagination-info">
            Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to {{ Math.min(currentPage * itemsPerPage, totalItems) }} of {{ totalItems }} entries
        </div>
        <div class="pagination-controls">
            <button 
                class="btn btn-pagination" 
                [disabled]="currentPage === 1"
                (click)="onPageChange(1)"
                title="First Page"
            >
                <i class="bi bi-chevron-double-left"></i>
            </button>
            <button 
                class="btn btn-pagination" 
                [disabled]="currentPage === 1"
                (click)="onPageChange(currentPage - 1)"
                title="Previous Page"
            >
                <i class="bi bi-chevron-left"></i>
            </button>
            
            <div class="page-numbers">
                <ng-container *ngFor="let page of getPageNumbers()">
                    <button 
                        *ngIf="page > 0"
                        class="btn btn-pagination"
                        [class.active]="page === currentPage"
                        (click)="onPageChange(page)"
                    >
                        {{ page }}
                    </button>
                    <span *ngIf="page < 0" class="pagination-ellipsis">...</span>
                </ng-container>
            </div>

            <button 
                class="btn btn-pagination" 
                [disabled]="currentPage === totalPages"
                (click)="onPageChange(currentPage + 1)"
                title="Next Page"
            >
                <i class="bi bi-chevron-right"></i>
            </button>
            <button 
                class="btn btn-pagination" 
                [disabled]="currentPage === totalPages"
                (click)="onPageChange(totalPages)"
                title="Last Page"
            >
                <i class="bi bi-chevron-double-right"></i>
            </button>
        </div>
    </div>
</div>

<!-- Add Admin Modal -->
<div class="modal fade" id="addAdminModal" tabindex="-1" aria-labelledby="addAdminModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addAdminModalLabel">Add New Admin</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form [formGroup]="adminForm" (ngSubmit)="addAdmin()" class="admin-form">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="adminName" class="form-label">Name</label>
                                <input type="text" id="adminName" formControlName="name" 
                                       class="form-control" [ngClass]="{'is-invalid': name?.invalid && name?.touched}">
                                <div class="invalid-feedback" *ngIf="name?.errors?.['required'] && name?.touched">
                                    Name is required
                                </div>
                                <div class="invalid-feedback" *ngIf="name?.errors?.['minlength'] && name?.touched">
                                    Name must be at least 3 characters long
                                </div>
                                <div class="invalid-feedback" *ngIf="name?.errors?.['maxlength'] && name?.touched">
                                    Name cannot exceed 20 characters
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="adminEmail" class="form-label">Email</label>
                                <input type="email" id="adminEmail" formControlName="email" 
                                       class="form-control" [ngClass]="{'is-invalid': email?.invalid && email?.touched}">
                                <div class="invalid-feedback" *ngIf="email?.errors?.['required'] && email?.touched">
                                    Email is required
                                </div>
                                <div class="invalid-feedback" *ngIf="email?.errors?.['email'] && email?.touched">
                                    Please enter a valid email address
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="adminPassword" class="form-label">Password</label>
                                <input type="password" id="adminPassword" formControlName="password" 
                                       class="form-control" [ngClass]="{'is-invalid': password?.invalid && password?.touched}">
                                <div class="invalid-feedback" *ngIf="password?.errors?.['required'] && password?.touched">
                                    Password is required
                                </div>
                                <div class="invalid-feedback" *ngIf="password?.errors?.['pattern'] && password?.touched">
                                     Password Must Be At least 6 Characters Long And At least Contains (one uppercase letter, one lowercase letter, one digit, and one special character(!&#64;#$%^&*) ).
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="adminGender" class="form-label">Gender</label>
                                <select id="adminGender" formControlName="gender" 
                                        class="form-select" [ngClass]="{'is-invalid': gender?.invalid && gender?.touched}">
                                    <option value="">Select Gender</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                </select>
                                <div class="invalid-feedback" *ngIf="gender?.errors?.['required'] && gender?.touched">
                                    Please select a gender
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="adminPhone" class="form-label">Phone</label>
                                <input type="text" id="adminPhone" formControlName="phone" 
                                       class="form-control" [ngClass]="{'is-invalid': phone?.invalid && phone?.touched}">
                                <div class="invalid-feedback" *ngIf="phone?.errors?.['required'] && phone?.touched">
                                    Phone number is required
                                </div>
                                <div class="invalid-feedback" *ngIf="phone?.errors?.['pattern'] && phone?.touched">
                                    Please enter a valid Egyptian phone number (e.g., 01XXXXXXXXX)
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="adminPhoto" class="form-label">Profile Photo URL</label>
                                <input type="text" id="adminPhoto" formControlName="profilePhoto" 
                                       class="form-control" [ngClass]="{'is-invalid': profilePhoto?.invalid && profilePhoto?.value !== ''}"
                                       placeholder="https://example.com/photo.jpg">
                                <div class="invalid-feedback" *ngIf="profilePhoto?.errors?.['pattern'] && profilePhoto?.value !== ''">
                                    Please enter a valid image URL (jpg, jpeg, png, or gif)
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary" [disabled]="adminForm.invalid">Add Admin</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Edit User Modal -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">Edit User</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div *ngIf="userToEdit" class="edit-form">
                    <div class="form-group">
                        <label class="form-label">Name</label>
                        <input type="text" [(ngModel)]="userToEdit.name" class="form-control" 
                               placeholder="Enter new name">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" (click)="updateUserName()">Save Changes</button>
            </div>
        </div>
    </div>
</div>