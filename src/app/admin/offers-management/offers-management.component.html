<div class="offers-management-container">
  <div class="page-header">
    <div class="header-content">
      <div class="title-wrapper">
        <div class="title-icon">
          <i class="bi bi-gift-fill"></i>
        </div>
        <div class="title-text">
          <h1 class="page-title">Manage Offers</h1>
          <p class="page-subtitle">Add, edit, or remove business offers</p>
        </div>
      </div>
    </div>
    <div class="header-actions">
      <!-- Add any header actions here if needed -->
    </div>
  </div>

  <div class="content-wrapper">
    <div class="offer-form-card">
      <form [formGroup]="offerForm" (ngSubmit)="onSubmit()" class="offer-form">
        <div class="form-grid">
          <div class="form-group">
            <label for="name" class="form-label">Offer Name</label>
            <input 
              type="text" 
              formControlName="description" 
              id="name" 
              class="form-control" 
              placeholder="Enter offer description" 
              required 
            />
            <div class="error-message" *ngIf="offerForm.get('description')?.invalid && offerForm.get('description')?.touched">
              <span *ngIf="offerForm.get('description')?.errors?.['required']">Description is required</span>
              <span *ngIf="offerForm.get('description')?.errors?.['minlength']">Description must be at least 3 characters</span>
            </div>
          </div>

          <div class="form-group">
            <label for="price" class="form-label">Price</label>
            <input 
              type="number" 
              formControlName="price" 
              id="price" 
              class="form-control" 
              placeholder="Enter offer price" 
              required 
            />
            <div class="error-message" *ngIf="offerForm.get('price')?.invalid && offerForm.get('price')?.touched">
              <span *ngIf="offerForm.get('price')?.errors?.['required']">Price is required</span>
              <span *ngIf="offerForm.get('price')?.errors?.['min']">Price must be greater than 0</span>
            </div>
          </div>

          <div class="form-group">
            <label for="startDate" class="form-label">Start Date</label>
            <input 
              type="datetime-local" 
              formControlName="startDate" 
              id="startDate" 
              class="form-control" 
              required 
            />
            <div class="error-message" *ngIf="offerForm.get('startDate')?.invalid && offerForm.get('startDate')?.touched">
              <span *ngIf="offerForm.get('startDate')?.errors?.['required']">Start date is required</span>
            </div>
          </div>

          <div class="form-group">
            <label for="endDate" class="form-label">End Date</label>
            <input 
              type="datetime-local" 
              formControlName="endDate" 
              id="endDate" 
              class="form-control" 
              required 
            />
            <div class="error-message" *ngIf="offerForm.get('endDate')?.invalid && offerForm.get('endDate')?.touched">
              <span *ngIf="offerForm.get('endDate')?.errors?.['required']">End date is required</span>
            </div>
          </div>

          <div class="form-group">
            <label for="discountPercentage" class="form-label">Discount Percentage</label>
            <input 
              type="number" 
              formControlName="discountPercentage" 
              id="discountPercentage" 
              class="form-control" 
              required 
            />
            <div class="error-message" *ngIf="offerForm.get('discountPercentage')?.invalid && offerForm.get('discountPercentage')?.touched">
              <span *ngIf="offerForm.get('discountPercentage')?.errors?.['required']">Discount percentage is required</span>
              <span *ngIf="offerForm.get('discountPercentage')?.errors?.['min']">Discount must be at least 0%</span>
              <span *ngIf="offerForm.get('discountPercentage')?.errors?.['max']">Discount cannot exceed 100%</span>
            </div>
          </div>

          <div class="form-group">
            <label for="businessId" class="form-label">Business</label>
            <select 
              formControlName="businessId" 
              id="businessId" 
              class="form-control" 
              required
            >
              <option [ngValue]="null">Select a business</option>
              <option *ngFor="let business of businesses" [value]="business.businessId">
                {{ business.name }}
              </option>
            </select>
            <div class="error-message" *ngIf="offerForm.get('businessId')?.invalid && offerForm.get('businessId')?.touched">
              <span *ngIf="offerForm.get('businessId')?.errors?.['required']">Please select a business</span>
              <span *ngIf="offerForm.get('businessId')?.errors?.['min']">Please select a valid business</span>
            </div>
          </div>

          <div class="form-group full-width">
            <label for="image" class="form-label">Image URL</label>
            <input 
              type="text" 
              formControlName="image" 
              id="image" 
              class="form-control" 
              placeholder="Enter offer image URL" 
              required 
            />
            <div class="error-message" *ngIf="offerForm.get('image')?.invalid && offerForm.get('image')?.touched">
              <span *ngIf="offerForm.get('image')?.errors?.['required']">Image URL is required</span>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary">
            <i class="fas" [ngClass]="isEdit ? 'fa-save' : 'fa-plus'"></i>
            {{ isEdit ? 'Update Offer' : 'Add Offer' }}
          </button>
          <button 
            *ngIf="isEdit" 
            type="button" 
            class="btn btn-secondary" 
            (click)="resetForm()"
          >
            <i class="fas fa-times"></i>
            Cancel
          </button>
        </div>
      </form>
    </div>

    <div class="table-card">
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Description</th>
              <th>Price</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Business</th>
              <th class="actions-column">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let offer of paginatedOffers">
              <td data-label="ID">{{ offer.offerId }}</td>
              <td data-label="Description">{{ offer.description }}</td>
              <td data-label="Price">{{ offer.price }}</td>
              <td data-label="Start Date">{{ offer.startDate | date }}</td>
              <td data-label="End Date">{{ offer.endDate | date }}</td>
              <td data-label="Business">{{ getBusinessName(offer.businessId) }}</td>
              <td class="actions-cell">
                <div class="action-buttons">
                  <button 
                    class="btn btn-warning" 
                    (click)="editOffer(offer)"
                    title="Edit Offer"
                  >
                    <i class="fas fa-edit"></i>
                  </button>
                  <button 
                    class="btn btn-danger" 
                    (click)="deleteOffer(offer.offerId)"
                    title="Delete Offer"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="offers.length === 0">
              <td colspan="6" class="text-center py-4">
                <div class="no-data-message">
                  <i class="fas fa-tag no-data-icon"></i>
                  <p class="no-data-text">No offers found</p>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- Pagination -->
      <div class="pagination-wrapper" *ngIf="totalPages > 1">
        <div class="pagination-info">
          Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to {{ Math.min(currentPage * itemsPerPage, filteredOffers.length) }} of {{ filteredOffers.length }} entries
        </div>
        <div class="pagination-controls">
          <button 
            class="btn btn-pagination" 
            [disabled]="currentPage === 1"
            (click)="changePage(1)"
            title="First Page"
          >
            <i class="bi bi-chevron-double-left"></i>
          </button>
          <button 
            class="btn btn-pagination" 
            [disabled]="currentPage === 1"
            (click)="changePage(currentPage - 1)"
            title="Previous Page"
          >
            <i class="bi bi-chevron-left"></i>
          </button>
          
          <div class="page-numbers">
            <ng-container *ngFor="let page of getPageNumbers()">
              <button 
                *ngIf="page > 0"
                class="btn btn-pagination"
                [class.active]="page === currentPage"
                (click)="changePage(page)"
              >
                {{ page }}
              </button>
              <span *ngIf="page < 0" class="pagination-ellipsis">...</span>
            </ng-container>
          </div>

          <button 
            class="btn btn-pagination" 
            [disabled]="currentPage === totalPages"
            (click)="changePage(currentPage + 1)"
            title="Next Page"
          >
            <i class="bi bi-chevron-right"></i>
          </button>
          <button 
            class="btn btn-pagination" 
            [disabled]="currentPage === totalPages"
            (click)="changePage(totalPages)"
            title="Last Page"
          >
            <i class="bi bi-chevron-double-right"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>