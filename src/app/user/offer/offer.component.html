<!-- Offer Section -->
<section class="p-4 bg-light">
  <div class="container">
    <div class="row g-4 align-items-start">
      <!-- Main Image & Thumbnails -->
      <div class="col-lg-6 col-12 mb-4 mb-lg-0">
        <div class="card shadow-sm border-0 mb-3 overflow-hidden">
          <img [src]="offersList[0]?.image || 'assets/default-offer.jpg'" 
               class="img-fluid w-100" 
               style="height: 400px; object-fit: cover;"
               alt="Main Offer Image">
        </div>
        <div class="d-flex flex-wrap gap-2">
          <div *ngFor="let offer of offersList; let i = index" 
               class="card shadow-sm border-0 cursor-pointer"
               style="width: 80px; height: 80px; overflow: hidden;">
            <img [src]="offer.image" 
                 class="w-100 h-100" 
                 style="object-fit: cover;"
                 [alt]="'Offer ' + (i+1)">
          </div>
        </div>
      </div>

      <!-- Offer Details Card -->
      <div class="col-lg-6 col-12">
        <div class="card shadow-sm border-0 p-4 mb-4">
          <h2 class="gradient-text fw-bold mb-2">{{ offersList[0]?.description || 'Offer' }}</h2>
          <p class="text-secondary mb-3">{{ offersList[0]?.description }}</p>
          
          <div class="d-flex align-items-center mb-3">
            <span class="badge bg-warning text-dark me-2">Merchant</span>
            <span class="fw-semibold text-accent">Business #{{ businessId }}</span>
          </div>

          <!-- Coupon List -->
          <div class="mb-4">
            <div *ngFor="let offer of offersList; trackBy: trackByOfferId" 
                 class="card shadow-sm border-0 mb-3 p-3">
              <div class="d-flex align-items-center justify-content-between">
                <div>
                  <span class="fw-semibold">{{ offer.description }}</span>
                  <span *ngIf="offer.discountPercentage" 
                        class="badge bg-danger ms-2">{{ offer.discountPercentage }}% OFF</span>
                </div>
                <div class="d-flex align-items-center gap-2">
                  <span class="fw-bold text-accent fs-6">{{ offer.price | currency:'USD':'symbol' }}</span>
                  <div class="btn-group">
                    <button class="btn btn-outline-accent btn-sm" 
                            (click)="decreaseQuantity(offer.offerId)">-</button>
                    <span class="btn btn-sm disabled">{{ quantities[offer.offerId] || 1 }}</span>
                    <button class="btn btn-outline-accent btn-sm" 
                            (click)="increaseQuantity(offer.offerId)">+</button>
                  </div>
                  <button class="btn btn-accent btn-sm ms-2 btn-wide" 
                          (click)="addToCart(offer)">
                    <span>
                      <ng-container *ngIf="addedOfferIds.has(offer.offerId)">âœ” </ng-container>
                      Add to Cart
                    </span>
                  </button>
                  <button type="button" 
                          class="btn btn-outline-dark btn-sm" 
                          (click)="toggleWishlist(offer)">
                    <i class="fas fa-heart" 
                       [style.color]="wishlistIds.has(offer.offerId) ? 'red' : 'black'"
                       style="font-size: 1.2rem;">
                    </i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="d-flex gap-2 mb-3">
            <button class="btn btn-accent flex-grow-1" 
                    (click)="addMultipleOffersToCart(offersList)">
              Add All to Cart
            </button>
            <button class="btn btn-warning flex-grow-1" 
                    (click)="addMultipleOffersToCart(offersList.slice(1, 6), true)">
              Quick Buy
            </button>
          </div>

          <!-- Social Share -->
          <div class="d-flex align-items-center mt-3">
            <span class="text-secondary me-2">Share:</span>
            <div class="d-flex gap-2">
              <a href="#" class="btn btn-outline-accent btn-sm">
                <i class="fab fa-facebook-f"></i>
              </a>
              <a href="#" class="btn btn-outline-warning btn-sm">
                <i class="fab fa-twitter"></i>
              </a>
              <a href="#" class="btn btn-outline-danger btn-sm">
                <i class="fab fa-whatsapp"></i>
              </a>
            </div>
          </div>
        </div>

        <!-- Tabs for Terms & About -->
        <div class="card shadow-sm border-0">
          <div class="card-header bg-white border-0">
            <ul class="nav nav-tabs card-header-tabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" 
                        id="terms-tab" 
                        data-bs-toggle="tab" 
                        data-bs-target="#terms" 
                        type="button" 
                        role="tab">
                  Terms & Conditions
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        id="about-tab" 
                        data-bs-toggle="tab" 
                        data-bs-target="#about" 
                        type="button" 
                        role="tab">
                  About Merchant
                </button>
              </li>
            </ul>
          </div>
          <div class="card-body">
            <div class="tab-content">
              <div class="tab-pane fade show active" id="terms" role="tabpanel">
                <ul class="list-unstyled mb-0">
                  <li class="mb-2">
                    <i class="fas fa-check text-success me-2"></i>
                    Valid for dine-in, takeaway, and delivery orders.
                  </li>
                  <li class="mb-2">
                    <i class="fas fa-check text-success me-2"></i>
                    Offer valid until end of the month.
                  </li>
                  <li class="mb-2">
                    <i class="fas fa-check text-success me-2"></i>
                    Cannot be combined with other promotions.
                  </li>
                  <li>
                    <i class="fas fa-check text-success me-2"></i>
                    See merchant for more details.
                  </li>
                </ul>
              </div>
              <div class="tab-pane fade" id="about" role="tabpanel">
                <p class="text-secondary">Merchant info and description goes here. You can add more details as needed.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Related Offers -->
    <div class="row g-4">
      <h4 class="gradient-text fw-bold mb-4">Related Businesses</h4>
      
      <!-- Loading Spinner -->
      <div *ngIf="isLoadingRelatedBusinesses" class="col-12 text-center py-5">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3 text-muted">Loading related businesses...</p>
      </div>

      <!-- Related Businesses Slider -->
      <div *ngIf="!isLoadingRelatedBusinesses && recommendedBusinesses.length > 0" class="col-12">
        <swiper-container class="recommendations-swiper" [init]="false">
          <swiper-slide *ngFor="let product of recommendedBusinesses; trackBy: trackById">
            <div class="card h-100 shadow-sm hover-card">
              <!-- Card Image -->
              <div class="position-relative">
                <a [routerLink]="['/user/offer', product.businessId]" class="text-decoration-none">
                  <img [src]="product.images && product.images.length > 0 ? product.images[0].url : 'assets/default-offer.jpg'" 
                       class="card-img-top object-fit-cover" 
                       alt="Business Image" 
                       style="height: 200px; object-fit: cover;" />
                </a>
                <img [src]="product.logo || 'assets/default-logo.png'" 
                     class="position-absolute top-100 start-50 translate-middle rounded-circle border border-3 bg-white shadow-sm" 
                     style="width: 80px; height: 80px; margin-top: -40px;" 
                     alt="Business Logo" />
              </div>

              <div class="card-body pt-4 text-center d-flex flex-column justify-content-between">
                <div>
                  <h5 class="card-title fw-bold text-truncate mb-2">{{ product.name }}</h5>
                  <p>{{product.city}}/{{product.area}}</p>
                </div>
                <a class="btn btn-primary w-100 rounded-pill" [routerLink]="['/user/offer', product.businessId]">
                  Show Offers
                </a>
              </div>
            </div>
          </swiper-slide>
        </swiper-container>
        
        <!-- Pagination -->
        <div class="swiper-pagination"></div>
      </div>

      <!-- No Results Message -->
      <div *ngIf="!isLoadingRelatedBusinesses && recommendedBusinesses.length === 0" 
           class="col-12 text-center py-5">
        <p class="text-muted">No related businesses found.</p>
      </div>
    </div>

    <!-- Review Section -->
    <div class="row mt-5">
      <div class="col-12">
        <app-add-review [businessId]="businessId"></app-add-review>
      </div>
    </div>

  
  </div>
</section>
